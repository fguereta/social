{% extends 'index.html'%}
{% block htitle %}<title>MGD</title>{% endblock %} 

{% block contenido%}
 

<div class='panel panel-primary dialog-panel'>
    <div class='panel-body'>
		<div class="container">
			<div class='panel  panel-success dialog-panel  '>
     			<div class='panel-heading'>
					<h5><b>Datos de la solicitud N° {% for i in solicitud_enviado %}{{i.id}}{% endfor %}</b></h5>
     			 </div>
      
      <div class='panel-body'>
      		
		<form  method="POST" enctype="multipart/form-data" class="form-horizontal">

		<br>
		<br>
		<br>
		<br>
            
      	<div class="form-group">
         	<label for="paciente" class="control-label col-md-2  ">Solicitud N°</label> 
         	<div class="col-md-5">

            	{% for elemento in solicitud_enviado %}
            	<input class="form-control" id="idsolicitud" name="idsolicitud" type="hidden" value="{{elemento.solicitud_id}}"/>
            	<input class="form-control"  type="text" readonly="readonly" value="{{elemento.id}}"/>
            	{% endfor %}
          	</div>
      	</div>
        
        <div class="form-group">
          	<label for="paciente" class="control-label col-md-2 ">Solicitante:</label> 
          	<div class="col-md-5">
            	{% for elemento in solicitud_enviado %}
            	<input class="form-control" id="id_paciente" name="id_paciente" type="hidden" value="{{elemento.paciente.id}}"/>
            	<input class="form-control"  type="text" readonly="readonly" value="{{elemento.paciente.apellido}}, {{elemento.paciente.nombre}}. DNI: {{elemento.paciente.dni}}"/>
            	{% endfor %}
          	</div>
        </div>
       

        <div class="form-group">
          	<label for="paciente" class="control-label  col-md-2 ">Historia Clinica:</label> 
          	<div class="col-md-5">
            
            	{% for elemento in solicitud_enviado %}
            
            	<input class="form-control"  type="text" readonly="readonly" value="{{elemento.paciente.historiaclinica}} " readonly />
            	{% endfor %}
            
          	</div>
        </div>

        <br>
        <br>
      
         <legend ><div class=" col-md-offset-4">Detalles de la Solicitud N° {% for i in solicitud_enviado %}{{i.id}}{% endfor %}</div></legend>
        <br>
        <br>

        <div class="form-group">
          	<label for="paciente" class="control-label  col-md-3  col-md-offset-1 ">Medico a cargo:</label> 
          	<div class="col-md-5">
            	{% for elemento in solicitud_enviado %}
            	<input class="form-control"  type="text" readonly="readonly" value="{{elemento.medico.apellido}}, {{elemento.medico.nombre}}" readonly />
            	{% endfor %}
            
          	</div>
        </div>
        <br>

        
        <div class="form-group">
          	<label for="paciente" class="control-label  col-md-3 col-md-offset-1">Nombre del generico(1):</label> 
          	<div class="col-md-5">
            	{% for elemento in solicitud_enviado %}
            	<input class="form-control"  type="text" readonly="readonly" value="{{elemento.medicamento1.generico}}" readonly />
            	{% endfor %}
            
          	</div>
        </div>

        

        <div class="form-group">
          	<label for="paciente" class="control-label  col-md-3 col-md-offset-1">Dosis Diaria(1):</label> 
          	<div class="col-md-5">
            	{% for elemento in solicitud_enviado %}
            	<input class="form-control" readonly="readonly" type="text" value="{{elemento.dosis1}}" " />
            	{% endfor %}
         	</div>
        
        </div>
        <br>
        

        <div id='generico-2' style="display:none; ">
          	
          	<div class="form-group">
            	<label for="paciente" class="control-label  col-md-3 col-md-offset-1">Nombre del generico(2):</label> 
            	<div class="col-md-5">
            
              	{% for elemento in solicitud_enviado %}
            
              	<input class="form-control"  type="text" id='generico2' name='generico2' readonly="readonly" value="{{elemento.medicamento2.generico}}" readonly />
              	{% endfor %}
            
            	</div>
          	</div>

        

          	<div class="form-group">
            	<label for="paciente" class="control-label  col-md-3 col-md-offset-1">Dosis Diaria(2):</label> 
            	<div class="col-md-5">
              		{% for elemento in solicitud_enviado %}
              		<input class="form-control" readonly="readonly" id='dosis2' name='dosis2' type="text" value="{{elemento.dosis2}}" " />
              		{% endfor %}
            	</div>
          	</div>
        	<br>
        
        </div>
        

        <div id='generico-3' style="display:none; " >
        	<div class="form-group ">
          	<label for="paciente" class="control-label  col-md-3 col-md-offset-1">Nombre del generico(3):</label> 
          		<div class="col-md-5">
            
            		{% for elemento in solicitud_enviado %}
            
            		<input class="form-control"  type="text" readonly="readonly" id='generico3' name='generico3'  value="{{elemento.medicamento3.generico}}" readonly />
            		{% endfor %}
            
          		</div>
        	</div>

        

        	<div class="form-group">
          		<label for="paciente" class="control-label  col-md-3 col-md-offset-1">Dosis Diaria(3):</label> 
          		<div class="col-md-5">
            		{% for elemento in solicitud_enviado %}
            		<input class="form-control" readonly="readonly" type="text" id='dosis3' name='dosis3' value="{{elemento.dosis3}}" " />
            		{% endfor %}
         		</div>
        	</div>
        <br>
      	</div>

        <script  type="text/javascript" charset="utf-8" async defer>
          
        	var generico2 = $("#generico2").val();
        	var generico3 = $("#generico3").val()
        

        	if (generico2!=""){


          		$('#generico-2').show();
        	}



        	if (generico3!=""){


          		$('#generico-3').show();
        	}

		</script>

        <br>

        <div class="form-group">
          	<label for="comcancelado" class="control-label col-md-2 col-md-offset-2">Diagnostico:</label> 
          	<div class="col-md-5">
          		{% for elemento in solicitud_enviado %}
            
          		<textarea class="form-control" type='text' cols="40" id="comparcial" style='width:427px;height: 102px;' name="comparcial" rows="10" readonly>{{elemento.diagnostico}}</textarea>
          		{% endfor %}
          	</div>
	     </div>

			<br>
			<br>


		<div class="form-group">
					
			<div class="col-md-1 col-md-offset-10">
				{% for elemento in solicitud_enviado %}
					
				<a  onclick='cambiarestado({{elemento.id}},"{{elemento.paciente.dni}}","{{elemento.paciente.apellido}}","{{elemento.paciente.nombre}}","APROBADO");' style="cursor:pointer"><img  style="cursor:pointer"  class="profile-img" src="{{ MEDIA_URL }} /static/media/continuar.gif" title='Siguiente' alt=""></a>
				{% endfor %}

			</div>

		</div>



				
					</form>
				</div>
			</div>
		</div>
		<br>
		<br>
	</div>
</div>

{% if user.is_authenticated %}
              
              
<script  type="text/javascript" charset="utf-8" async defer>
                
    var user_id="{{user.userfarmacia.id}}";
    var user_id_farmacia=parseInt(user_id);
              
    $( "#user_id_farmacia1" ).val(user_id_farmacia);
    $( "#user_id_farmacia2" ).val(user_id_farmacia);

</script>
            

{% endif %}


<script type="text/javascript" charset="utf-8" async defer>
    


    
  
var razonsocial = $("#razonsocial").val();

    $(".chosen-select").chosen({no_results_text: "No existe ese paciente"});

    
function cambiarestado(id,dni,apellido,nombre,estado_aprobacion){
 
          if(estado_aprobacion=='APROBADO'){
  
          alertify.set({ labels: {
          ok     : "Siguiente",
          cancel : "Cancelar"
          } });
          // confirm dialog
          
                        
                  alertify.confirm("<div class='container '><div class='form-group'><div class='col-xs-3 col-md-offset-1'><div class='form-group'>SELECCIONE TIPO DE ENTREGA <br></br> <select class='form-control smallselect' id='nuevoestado' name='nuevoestado' ><option value='ENTREGADO'>ENTREGA COMPLETA</option><option value='PARCIAL'>ENTREGA PARCIAL</option></select></div></div></div></div> ", function (l) {

                        if (l) {

                            nuevo_estado=$('select[name=nuevoestado]').val();
                            
                                  if(nuevo_estado=='PARCIAL'){

                                 	

                                    $( "#idsolicitud_parcial" ).val(id);
                                    $( "#user_id_farmacia_parcial" ).val(user_id);
                                    $("#entrega_parcial").submit();
                  
                                  }else if(nuevo_estado=='ENTREGADO'){

                                    
                                    
                                    $( "#idsolicitud_completa" ).val(id);
                                    $( "#user_id_farmacia_completa" ).val(user_id);
                                    $("#entrega_completa").submit();

                                  }
                                   

                                  
                        

                        } else {
            
                            window.location.href = "/aplicacion/farmacia_entrega/";
          
                        }
        
                    });

           


      }

  
}

 



</script>

<form  id='entrega_completa' method='POST' action='/aplicacion/farmacia_entrega/' enctype='multipart/form-data' class='form-horizontal'>{% csrf_token %}
<input class='form-control' id='idsolicitud_completa' name='idsolicitud_completa'  type="hidden" value=''/>

<input class='form-control' id='user_id_farmacia_completa' name='user_id_farmacia_completa' type="hidden" value=''/>

</form>

<form  id='entrega_parcial' method='POST' action='/aplicacion/farmacia_entrega/' enctype='multipart/form-data' class='form-horizontal'>{% csrf_token %}
<input class='form-control' id='idsolicitud_parcial' name='idsolicitud_parcial' type="hidden"  value=''/>
<input class='form-control' id='user_id_farmacia_parcial' name='user_id_farmacia_parcial'  type="hidden" value=''/>

</form>



{% endblock %}